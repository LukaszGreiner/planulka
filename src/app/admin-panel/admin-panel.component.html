<div class="admin-panel-container">
  <div *ngIf="userRole === 'admin'; else noAccess">
    <div class="panel-card backdrop-blur-md bg-white/10 rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0,0.37)] animate-enter p-8 flex flex-col gap-6">
      <h2 class="!text-[var(--color-text-primary)]">Admin Panel</h2>

      <!-- Tasks Section -->
      <h3 class="!text-[var(--color-text-primary)]">All Tasks</h3>
      <div class="filters flex flex-wrap gap-6 mb-6">
        <mat-form-field
          appearance="outline"
          floatLabel="auto"
          class="themed-form-field w-full md:w-64"
        >
          <mat-icon matPrefix>filter_list</mat-icon>
          <mat-label>Filter by Status</mat-label>
          <mat-select [formControl]="statusFilter">
            <mat-option value="">All</mat-option>
            <mat-option value="todo">To Do</mat-option>
            <mat-option value="in_progress">In Progress</mat-option>
            <mat-option value="done">Done</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field
          appearance="outline"
          floatLabel="auto"
          class="themed-form-field w-full md:w-64"
        >
          <mat-icon matPrefix>sort</mat-icon>
          <mat-label>Sort by</mat-label>
          <mat-select [formControl]="sortBy">
            <mat-option value="">None</mat-option>
            <mat-option value="priority">Priority</mat-option>
            <mat-option value="createdAt">Creation Date</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field
          appearance="outline"
          floatLabel="auto"
          class="themed-form-field w-full md:w-64"
        >
          <mat-icon matPrefix>swap_vert</mat-icon>
          <mat-label>Sort Order</mat-label>
          <mat-select [formControl]="sortOrder">
            <mat-option value="asc">Ascending</mat-option>
            <mat-option value="desc">Descending</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <mat-table [dataSource]="tasks" class="mat-elevation-z8 admin-table">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <mat-header-cell *matHeaderCellDef>Title</mat-header-cell>
          <mat-cell *matCellDef="let task">{{ task.title }}</mat-cell>
        </ng-container>
        <!-- Priority Column -->
        <ng-container matColumnDef="priority">
          <mat-header-cell *matHeaderCellDef>Priority</mat-header-cell>
          <mat-cell *matCellDef="let task">{{
            task.priority | titlecase
          }}</mat-cell>
        </ng-container>
        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
          <mat-cell *matCellDef="let task">{{
            task.status | titlecase
          }}</mat-cell>
        </ng-container>
        <!-- Due Date Column -->
        <ng-container matColumnDef="dueDate">
          <mat-header-cell *matHeaderCellDef>Due Date</mat-header-cell>
          <mat-cell *matCellDef="let task">{{
            task.dueDate | date : "shortDate"
          }}</mat-cell>
        </ng-container>
        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
          <mat-cell *matCellDef="let task">
            <button
              mat-icon-button
              color="primary"
              (click)="editTask(task)"
              aria-label="Edit task"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              color="warn"
              (click)="deleteTask(task)"
              aria-label="Delete task"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="taskColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: taskColumns"></mat-row>
      </mat-table>

      <!-- Users Section -->
      <h3 class="!text-[var(--color-text-primary)] users-heading">All Users</h3>
      <mat-table
        [dataSource]="(users$ | async) ?? []"
        class="mat-elevation-z8 admin-table"
      >
        <ng-container matColumnDef="email">
          <mat-header-cell *matHeaderCellDef>Email</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.email }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="role">
          <mat-header-cell *matHeaderCellDef>Role</mat-header-cell>
          <mat-cell *matCellDef="let user">{{ user.role }}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
          <mat-cell *matCellDef="let user">
            <button
              mat-icon-button
              color="primary"
              (click)="editUserRole(user)"
              aria-label="Edit user role"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              color="warn"
              (click)="deleteUser(user)"
              aria-label="Delete user"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="userColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: userColumns"></mat-row>
      </mat-table>
    </div>
  </div>
</div>
<ng-template #noAccess>
  <p class="no-access-message">
    You do not have permission to access this page.
  </p>
</ng-template>
